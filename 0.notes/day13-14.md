# day13-14
> 接口自动化测试框架

---

## 概述

#### 各种定义
* 自动化
* 接口测试
* 框架

#### 用途
* 节省人力成本
* 提升测试覆盖率

---

## 思考

#### 节省人力成本？
* 如何计算的？凭借感觉？依据对自动化的熟悉？还是业界的统一说辞？
    - "每次运行5分钟就结束了，如果这些case要人工去跑的话需要一个小时或者半天"

#### 自动化case现在有哪些痛点？
* 编写成本？
* 便捷性？
* 维护成本？
* 覆盖率？
* ===============

#### 目前的自动化为业务带来了哪些收益？
* 只是发现了多少Bug？？？
* 比如： 
    - 准入
    - 冒烟
    - 拦截率
    - 召回率

#### 自动化的到底是什么？
* 就只是接口case的run呀run？run...run...run?
* 思考：在整个体系中的角色，是否是一个连接所有节点的核心，然后能将所有系统全部连起来，并做到自动xxxx

#### 整个框架的设计思路是什么？
* 一堆脚本。。。。

---

## 调研

#### 一般做法
* UI自动化
    * 工具
    * 框架
    * 实践

* 接口自动化
    * 美团lego
    * 蚂蚁 sofa-act
    * 开源 python实现的 test

* 找一个参考，开干

#### 我认可的做法
* 分析业务不同维度的特点
    - 业务复杂度
        + 横向： 如：api数目较多，比如有几千个接口，但是每个接口的请求参数并不复杂，且内部逻辑较简单？
        + 纵向: 如：api数目并不多，但是每个接口内部的逻辑纵向比较深，比如一个接口从发起请求，到走完一个流程，要走很多的模块，落地很多的数据，做很多很多的逻辑判断
        + 横纵均有：。。。
    - 业务测试难度
        + 偏简单型：基本靠点页面，或操作app就可验证大概98%的业务逻辑
        + 偏复杂型: 就算把页面都拆了，每个按钮点100遍，业务的覆盖也就能覆盖住5%。
            * 例如：佣金宝，同花顺： 页面复杂的。。。。。
            * 例如：滴滴打车，美团外卖： 那页面简单的，感觉就一个框，一个按钮。。。还有微信/支付宝支付，一个二维码，一个确定，是不感觉也就2个接口，2个人就能搞定。。。
    - 业务的依赖程度
        + 对内部组件依赖较多，如： passport，实名服务，用户中心，id生成器，mq组件， 动态配置服务，服务注册中心。。。。
        + 对外部依赖： 如金融类业务，特点就是几乎所有功能都是跟外部机构和银行交互，这样的与社交的聊天能一样？
    - 业务特点
        + 场景较多，如 完成一次外卖订餐，需要选择，进店，获取优惠规则，选择商品，加入购物车，下单，下单确认回调给用户，支付，接单，分配骑手，骑手接单，骑手路线，骑手接单，骑手送单，骑手确认接单，用户确认，评价，超期订单自动结束，商家分账，商家结算，商家提现。商家与平台对账
        + 场景较少，A约B，妹儿，YP吗？约，酒店走起？110房间，啊啊啊啊，结束。 
    - 系统设计
        + 分层架构？？？
        + 微服务？？ 云？？
        + 还是泥马的一个单体的应用。。。。
    - 系统特点
        + http微服务，SpringCloud。。。
        + dubbo微服务
        + http+dubbo/thrift/gRPC
    - 组内大家的技术认知
        + Java技术栈，啥？Java是啥？算了，别做啥框架了，还是去开心的点点点吧
        + 一群技术牛X的小哥哥，小姐姐，做框架？？？ 太low的不要上哈。。。

* 确定边界
    - 定义清楚，到底要做哪些业务，解决哪些实际问题。目标要清晰，明确。
    - 结合以上业务摸底，结合特点明确要落地在哪些特点之上。不同的特点，做出来的框架设计完全不同。
    - 千万别一锤子下去，感觉你做的东西适用于 电商，社交，搜索，打车，外卖，直播。。。。越是适用的多，就越是不适用。

* 调研业务线的同学的一些感受
    - 甚至亲自去感受一下整个的测试过程。千万不要，xxx我给你做了一个东西，xxx说啥？你这个是啥？不是我要的啊。

* 这时在去看业界，看现有实现。然后整合，输出一个具备业务特点的东西，定制化的
    - 给别人说的时候，每一个你这样做的事情，都有一个前置条件，我们的业务是xxx的，所以当时有这样的xxx问题，所以我的框架做了这样的xxx
    - 不要说框架的时候，感觉这个框架能放到任何一个公司的任何一个业务，那这个就是0分
    

----

## 设计
#### 内部真实实现
* 啥快就干啥，赶紧出。不行后面在优化去迭代

#### 面对晋升/面试
* 业务特点->内外部差异和现状/摸底->业务定制化输出->架构设计->实际效果->数据说话

---

## 实现

#### 我们要做哪些事
* 便捷能力
    - http
    - dubbo
    - mysql
    - redis
    - kafka
    - amq
    - utils
    - 内部组件(略)
* 规范化组织
    - 规范约定和限制
    - 用例格式限制和描述
* 基本能力
    - 用例运行
    - 用例报警
    - 用例分级
    - 用例管理
    - 用例维护

#### 关于框架
* 工具
* 框架
* 服务
* 需求
* 诉求

---

## 迭代

#### 排期
* 将以上所有种种整合后，然后以周为单位做排期

#### 划分
* 一期，完成什么
* 二期，完成什么


---

## 总结

#### 自动化是一个烂大街的东西

#### 自动化是一个看似水很浅，没啥技术含量的东西

#### 自动化是一个看似谁都可以玩的东西

#### 自动化看似是一个实习生在做，技术大佬也在做，大家都是做自动化的，那么真的就是一样的吗？
